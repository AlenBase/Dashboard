{"version":3,"file":"index.esm.js","sources":["../node_modules/style-inject/dist/style-inject.es.js","../src/MapPlot.jsx"],"sourcesContent":["function styleInject(css, ref) {\n  if ( ref === void 0 ) ref = {};\n  var insertAt = ref.insertAt;\n\n  if (!css || typeof document === 'undefined') { return; }\n\n  var head = document.head || document.getElementsByTagName('head')[0];\n  var style = document.createElement('style');\n  style.type = 'text/css';\n\n  if (insertAt === 'top') {\n    if (head.firstChild) {\n      head.insertBefore(style, head.firstChild);\n    } else {\n      head.appendChild(style);\n    }\n  } else {\n    head.appendChild(style);\n  }\n\n  if (style.styleSheet) {\n    style.styleSheet.cssText = css;\n  } else {\n    style.appendChild(document.createTextNode(css));\n  }\n}\n\nexport default styleInject;\n","import React, { useRef, useState, useEffect, useCallback } from 'react';\r\nimport './MapPlot.css';\r\n\r\nfunction lat2tile(lat, zoom) {\r\n  const rad = (lat * Math.PI) / 180;\r\n  return ((1 - Math.log(Math.tan(rad) + 1 / Math.cos(rad)) / Math.PI) / 2) * 2 ** zoom;\r\n}\r\n\r\nfunction lon2tile(lon, zoom) {\r\n  return ((lon + 180) / 360) * 2 ** zoom;\r\n}\r\n\r\nexport function MapPlot({ center = [37.8, -96], zoom = 4, tileSize = 256, width = 800, height = 600 }) {\r\n  const containerRef = useRef(null);\r\n  const [cz, setCz] = useState(zoom);\r\n  const [centerPx, setCenterPx] = useState([0, 0]);\r\n  const [isDragging, setIsDragging] = useState(false);\r\n  const dragStart = useRef([0, 0]);\r\n\r\n  const recalc = useCallback(() => {\r\n    const [lat, lon] = center;\r\n    const x = lon2tile(lon, cz) * tileSize;\r\n    const y = lat2tile(lat, cz) * tileSize;\r\n    setCenterPx([x, y]);\r\n  }, [center, cz, tileSize]);\r\n\r\n  useEffect(() => { recalc(); }, [recalc]);\r\n\r\n  useEffect(() => {\r\n    const cont = containerRef.current;\r\n    if (!cont) return;\r\n    const onMouseDown = e => { setIsDragging(true); dragStart.current = [e.clientX, e.clientY]; };\r\n    const onMouseMove = e => {\r\n      if (!isDragging) return;\r\n      const dx = e.clientX - dragStart.current[0];\r\n      const dy = e.clientY - dragStart.current[1];\r\n      dragStart.current = [e.clientX, e.clientY];\r\n      setCenterPx(([cx, cy]) => [cx - dx, cy - dy]);\r\n    };\r\n    const onMouseUp = () => setIsDragging(false);\r\n    const onWheel = e => { e.preventDefault(); setCz(z => Math.max(1, Math.min(19, z + (e.deltaY > 0 ? -1 : 1)))); };\r\n\r\n    cont.addEventListener('mousedown', onMouseDown);\r\n    window.addEventListener('mousemove', onMouseMove);\r\n    window.addEventListener('mouseup', onMouseUp);\r\n    cont.addEventListener('wheel', onWheel, { passive: false });\r\n\r\n    return () => {\r\n      cont.removeEventListener('mousedown', onMouseDown);\r\n      window.removeEventListener('mousemove', onMouseMove);\r\n      window.removeEventListener('mouseup', onMouseUp);\r\n      cont.removeEventListener('wheel', onWheel);\r\n    };\r\n  }, [isDragging]);\r\n\r\n  const cols = Math.ceil(width / tileSize) + 2;\r\n  const rows = Math.ceil(height / tileSize) + 2;\r\n  const centerCol = centerPx[0] / tileSize;\r\n  const centerRow = centerPx[1] / tileSize;\r\n  const startCol = Math.floor(centerCol - cols / 2);\r\n  const startRow = Math.floor(centerRow - rows / 2);\r\n\r\n  const tiles = [];\r\n  for (let r = 0; r < rows; r++) {\r\n    for (let c = 0; c < cols; c++) {\r\n      const tx = startCol + c;\r\n      const ty = startRow + r;\r\n      const max = 2 ** cz;\r\n      const xWrapped = ((tx % max) + max) % max;\r\n      if (ty < 0 || ty >= max) continue;\r\n      const left = c * tileSize + (width / 2 - (centerPx[0] % tileSize) - tileSize);\r\n      const top = r * tileSize + (height / 2 - (centerPx[1] % tileSize) - tileSize);\r\n      tiles.push({ x: xWrapped, y: ty, left, top });\r\n    }\r\n  }\r\n\r\n  return (\r\n    <div ref={containerRef} className=\"map-plot-container\" style={{ width, height }}>\r\n      {tiles.map((t, i) => (\r\n        <img\r\n          key={`${t.x}-${t.y}-${i}`}\r\n          src={`https://tile.openstreetmap.org/${cz}/${t.x}/${t.y}.png`}\r\n          alt=\"\"\r\n          className=\"map-tile\"\r\n          style={{ width: tileSize, height: tileSize, left: t.left, top: t.top }}\r\n        />\r\n      ))}\r\n    </div>\r\n  );\r\n}"],"names":["lat2tile","lat","zoom","rad","Math","PI","log","tan","cos","lon2tile","lon","MapPlot","_ref","center","tileSize","width","height","containerRef","useRef","cz","setCz","useState","centerPx","setCenterPx","isDragging","setIsDragging","dragStart","recalc","useCallback","x","y","useEffect","cont","current","onMouseDown","e","clientX","clientY","onMouseMove","dx","dy","_ref2","cx","cy","onMouseUp","onWheel","preventDefault","z","max","min","deltaY","addEventListener","window","passive","removeEventListener","cols","ceil","rows","centerCol","centerRow","startCol","floor","startRow","tiles","r","c","tx","ty","xWrapped","left","top","push","React","createElement","ref","className","style","map","t","i","key","concat","src","alt"],"mappings":"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","x_google_ignoreList":[0]}